<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Widget Editor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        form {
            max-width: 500px;
            margin: 0 auto;
        }
        label {
            font-weight: bold;
        }
        input[type="text"] {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }
        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 4px;
        }
        button:hover {
            background-color: #45a049;
        }
        #fileInput {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <h1>Editor de Widgets</h1>
    <input type="file" id="fileInput" accept=".xml">
    <button onclick="loadXML()">Cargar XML</button>
    
    <form id="widgetForm" style="display: none;">
        <label for="name">Nombre:</label><br>
        <input type="text" id="name" name="name"><br>
        
        <label for="description">Descripción:</label><br>
        <input type="text" id="description" name="description"><br>
        
        <label for="author">Autor:</label><br>
        <input type="text" id="author" name="author"><br>
        
        <label for="authorEmail">Email del autor:</label><br>
        <input type="text" id="authorEmail" name="authorEmail"><br>
        
        <label for="authorHref">URL del autor:</label><br>
        <input type="text" id="authorHref" name="authorHref"><br>
        
        <label for="contentSrc">Fuente de contenido:</label><br>
        <input type="text" id="contentSrc" name="contentSrc"><br>
        
        <label for="androidKeyStore">Almacén de claves (Android):</label><br>
        <input type="text" id="androidKeyStore" name="androidKeyStore"><br>
        
        <label for="androidKeyStorePass">Contraseña del almacén (Android):</label><br>
        <input type="text" id="androidKeyStorePass" name="androidKeyStorePass"><br>
        
        <label for="androidKeyAlias">Alias de la clave (Android):</label><br>
        <input type="text" id="androidKeyAlias" name="androidKeyAlias"><br>
        
        <label for="androidKeyPass">Contraseña de la clave (Android):</label><br>
        <input type="text" id="androidKeyPass" name="androidKeyPass"><br>
        
        <button type="button" onclick="saveXML()">Guardar XML</button>
        <button type="button" onclick="resetForm()">Restablecer</button>
    </form>
    
    <div id="message" style="display: none;">
        <p>¡El archivo XML se ha guardado correctamente!</p>
    </div>

    <script>
        var xmlDoc;

        function loadXML() {
            var fileInput = document.getElementById('fileInput');
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(e) {
                var parser = new DOMParser();
                xmlDoc = parser.parseFromString(e.target.result, "text/xml");

                document.getElementById("name").value = xmlDoc.querySelector("name").textContent;
                document.getElementById("description").value = xmlDoc.querySelector("description").textContent;
                document.getElementById("author").value = xmlDoc.querySelector("author").textContent;
                document.getElementById("authorEmail").value = xmlDoc.querySelector("author").getAttribute("email");
                document.getElementById("authorHref").value = xmlDoc.querySelector("author").getAttribute("href");
                document.getElementById("contentSrc").value = xmlDoc.querySelector("content").getAttribute("src");
                document.getElementById("androidKeyStore").value = xmlDoc.querySelector("preference[name='android-signing-key-store']").getAttribute("value");
                document.getElementById("androidKeyStorePass").value = xmlDoc.querySelector("preference[name='android-signing-key-store-password']").getAttribute("value");
                document.getElementById("androidKeyAlias").value = xmlDoc.querySelector("preference[name='android-signing-key-alias']").getAttribute("value");
                document.getElementById("androidKeyPass").value = xmlDoc.querySelector("preference[name='android-signing-key-password']").getAttribute("value");

                document.getElementById("widgetForm").style.display = "block";
            };
            reader.readAsText(file);
        }

        function saveXML() {
            xmlDoc.querySelector("name").textContent = document.getElementById("name").value;
            xmlDoc.querySelector("description").textContent = document.getElementById("description").value;
            xmlDoc.querySelector("author").textContent = document.getElementById("author").value;
            xmlDoc.querySelector("author").setAttribute("email", document.getElementById("authorEmail").value);
            xmlDoc.querySelector("author").setAttribute("href", document.getElementById("authorHref").value);
            xmlDoc.querySelector("content").setAttribute("src", document.getElementById("contentSrc").value);
            xmlDoc.querySelector("preference[name='android-signing-key-store']").setAttribute("value", document.getElementById("androidKeyStore").value);
            xmlDoc.querySelector("preference[name='android-signing-key-store-password']").setAttribute("value", document.getElementById("androidKeyStorePass").value);
            xmlDoc.querySelector("preference[name='android-signing-key-alias']").setAttribute("value", document.getElementById("androidKeyAlias").value);
            xmlDoc.querySelector("preference[name='android-signing-key-password']").setAttribute("value", document.getElementById("androidKeyPass").value);

            var xmlString = new XMLSerializer().serializeToString(xmlDoc);
            var blob = new Blob([xmlString], {type: "text/xml"});
            var filename = document.getElementById('fileInput').files[0].name;
            var a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(blob);

            // Show success message
            document.getElementById("message").style.display = "block";
            setTimeout(function() {
                document.getElementById("message").style.display = "none";
            }, 3000);
        }

        function resetForm() {
            document.getElementById("widgetForm").reset();
        }
    </script>
</body>
</html>
